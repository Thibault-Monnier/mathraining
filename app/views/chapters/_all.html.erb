<!-- Prérequis -->
<h3>Prérequis</h3>
<% if @chapter.prerequisites.count == 0 %>
  <p>Aucun prérequis.</p>
<% else %>
  <ul>
    <% @chapter.prerequisites.order(:level).each do |prerequisite| %>
      <li><%= link_to prerequisite.name, prerequisite %></li>
    <% end %>
  </ul>
<% end %>

<!-- Résumé -->
<h3>Résumé</h3>
<%= raw(htmlise(@chapter.description)) %>

<!-- Auteur(s) et date de publication -->
<% author_ok = (!@chapter.author.nil? && @chapter.author.size != 0) %>
<% publication_ok = !@chapter.publication_date.nil? %>
<% if author_ok || publication_ok %>
  <p class="mt-4">Ce chapitre a été
  <% if author_ok %>
    écrit par <b><%= @chapter.author %></b><%= "." if !publication_ok %><%= " et " if publication_ok %>
  <% end %>
  <% if publication_ok %>
    mis en ligne le <b><%= write_date_only(@chapter.publication_date) %></b>.
  <% end %>
  </p>
<% end %>

<!-- Toutes les théories -->
<% listex = @chapter.theories.order(:position) %>
<% i = 1 %>
<% numLatexTest = 0 %>
<% listex.each do |f| %>
  <% if f.online || !@chapter.online %>
    <h3 class="mt-4"><%= i %>. <%= f.title %></h3>
    <div>
      <% numLatexTest += 1 if f.content.include? "latextest" %>
      <% if numLatexTest <= 1 %>
        <%= raw(htmlise(f.content).gsub(/\/latextest\//, '<div class="mb-2"><div class="card text-bg-ld-light-dark"><div class="card-body" id="MathPreview"></div><div class="card-body hidden-preview" id="MathBuffer"></div></div><textarea id="MathInput" class="form-control mt-2" style="height:120px;" onkeyup="PreviewSafe.Update()" placeholder="Rentrez ici le code $\LaTeX$ que vous souhaitez tester."></textarea></div><script>initAndUpdatePreviewSafeAtLoad(true);</script>')) %>
      <% else %>
        <%= raw(htmlise(f.content).gsub(/\/latextest\//, '<center><i>Voir plus haut.</i></center>')) %>
      <% end %>
    </div>
    <% i = i+1 %>
  <% end %>
<% end %>

<% if @chapter.online && @signed_in && !current_user.sk.admin? %>
  <!-- Marquer comme lu -->
  <center><%= button_to "Marquer toute la théorie comme lue", chapter_read_path(@chapter), :method => :put, class: 'btn btn-ld-light-dark mt-3', :disabled => (!@signed_in || current_user.other) %></center>
  
  <hr class="bottom-help" />
  <p>Des questions ? N'hésitez pas à demander de l'aide sur le <%= link_to "forum", subjects_path(:q => @chapter.id) %> !</p>
<% end %>
