<%= render 'chapters/before', active: 'question-' + @question.id.to_s %>

<% admin_or_author = !@chapter.online? || (signed_in? && current_user.admin?) %>
<% solvedquestion = (!signed_in? || admin_or_author) ? nil : current_user.solvedquestions.where(:question => @question).first %>
<% unsolvedquestion = (!signed_in? || admin_or_author || !solvedquestion.nil? ? nil : current_user.unsolvedquestions.where(:question => @question).first) %>
<% unsolvedquestion = Unsolvedquestion.new if unsolvedquestion.nil? %>
<% can_see_answer = admin_or_author || !solvedquestion.nil? %>

<script type="text/javascript">
var showAnswer = function () {
  $.getScript("<%= show_answer_question_url(@question) %>");
}
</script>

<!-- Titre -->
<%= render 'questions/title', question: @question, number: @number, solved: !solvedquestion.nil? %>

<!-- Enoncé -->
<div><%= htmlise(@question.statement, true) %></div>

<div id="question-div">
<% if can_see_answer && @show_answer %>
  <!-- Réponse, félicitations, explication -->
  <%= render 'questions/full_answer', solvedquestion: solvedquestion %>
<% else %>
  <!-- Formulaire pour répondre (pour de vrai ou pour le fun) -->
  <%= render 'questions/question', question: @question, unsolvedquestion: unsolvedquestion %>
  
  <% if can_see_answer %>
    <!-- Bouton pour voir la réponse -->
    <p class="text-center mt-3 mb-0"><a href="javascript:showAnswer();" class="btn btn-ld-light-dark">Voir la réponse</a></p>
  <% end %>
<% end %>
</div>

<% if admin_or_author %>
  <!-- Boutons pour les admins -->
  <%= render 'questions/admin', question: @question %>
<% else %>
  <hr class="bottom-help" />
  <% if signed_in? %>
    <% subject = @question.subject %>
    Un souci avec cet exercice ? N'hésitez pas à demander de l'aide sur le <%= link_to "forum", (!subject.nil? ? subject_path(subject) : subjects_path(:q => "cha-" + @chapter.id.to_s)), :target => "_blank" %> !
  <% else %>
    Pour pouvoir répondre aux exercices, vous devez être connecté.
  <% end %>
<% end %>

<%= render 'chapters/after' %>
